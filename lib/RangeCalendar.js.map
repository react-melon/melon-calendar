{"version":3,"sources":["RangeCalendar.js"],"names":["DateTime","cx","RangeCalendar","props","context","begin","end","value","state","open","date","getNormalizeValue","onLabelClick","bind","onConfirm","onCancel","onDateChange","getSyncUpdates","nextProps","disabled","customValidity","readOnly","defaultValue","vilidity","length","stringifyValue","Date","parseDate","valueBegin","valueEnd","isAfterDate","isBeforeDate","map","formatDate","setState","index","e","concat","isEqualDate","onChange","type","target","format","dateFormat","parse","render","lang","size","name","placeholder","others","validity","addStates","focus","build","join","part","displayName","defaultProps","propTypes","arrayOf","string","autoOk","bool","oneOfType","object","childContextTypes","contextTypes"],"mappings":"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","file":"RangeCalendar.js","sourcesContent":["/**\n * @file melon/RangeCalendar\n * @author cxtom <cxtom2008@gmail.com>\n *         leon <ludafa@outlook.com>\n */\n\nimport React, {PropTypes} from 'react';\n\nimport Validity from 'melon-core/Validity';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport InputComponent from 'melon-core/InputComponent';\nimport {getNextValidity} from 'melon-core/util/syncPropsToState';\n\nimport Icon from 'melon/Icon';\nimport Confirm from 'melon/Confirm';\n\nimport Calendar from './Calendar';\nimport Panel from './calendar/Panel';\nimport * as DateTime from './util';\n\nconst cx = create('RangeCalendar');\n\n/**\n * melon 日期区间选择器\n *\n * @class\n * @extends {melon-core/InputComponent}\n */\nexport default class RangeCalendar extends InputComponent {\n\n    /**\n     * 构造函数\n     *\n     * @param  {Object} props   组件属性\n     * @param  {Object} context 组件上下文\n     * @public\n     */\n    constructor(props, context) {\n\n        super(props, context);\n\n        const {begin, end} = props;\n\n        const value = this.state.value;\n\n        /**\n         * 组件状态\n         *\n         * @type {Object}\n         */\n        this.state = {\n            ...this.state,\n            open: false,\n            date: this.getNormalizeValue(value, begin, end)\n        };\n\n        this.onLabelClick = this.onLabelClick.bind(this);\n        this.onConfirm = this.onConfirm.bind(this);\n        this.onLabelClick = this.onLabelClick.bind(this);\n        this.onCancel = this.onCancel.bind(this);\n        this.onDateChange = this.onDateChange.bind(this);\n    }\n\n    /**\n     * 组件每次更新 (componentWillRecieveProps) 时，需要\n     * 更新组件状态，包括校验信息、同步 date 和 value\n     *\n     * @param  {Object} nextProps 组件更新的属性\n     * @return {Object}           最新的组件状态\n     * @public\n     */\n    getSyncUpdates(nextProps) {\n\n        const {\n            disabled,\n            customValidity,\n            readOnly,\n            value = nextProps.defaultValue,\n            begin,\n            end\n        } = nextProps;\n\n        // 如果有值，那么就试着解析一下；否则设置为 null\n        let date = value ? this.getNormalizeValue(value, begin, end) : null;\n\n        const vilidity = getNextValidity(this, {value, disabled, customValidity});\n\n        return {\n            date,\n            vilidity,\n            value: (disabled || readOnly || !value.length) ? value : this.stringifyValue(date)\n        };\n\n    }\n\n    /**\n     * 获取过滤后的日期对象区间\n     *\n     * @param  {Array<string>} value 时间区间值\n     * @param  {string|Date}   begin 范围最新值\n     * @param  {string|Date}   end   范围最大值\n     * @return {Array<Date>}         日期对象区间\n     * @private\n     */\n    getNormalizeValue(value, begin, end) {\n\n        if (value.length === 0) {\n            return [new Date(), new Date()];\n        }\n\n        begin = this.parseDate(begin);\n        end = this.parseDate(end);\n\n        let valueBegin = this.parseDate(value[0]);\n        let valueEnd = this.parseDate(value[1]);\n\n        // 这里我们需要一个全新的 value\n        value = [\n            begin && DateTime.isAfterDate(begin, valueBegin) ? begin : valueBegin,\n            end && DateTime.isBeforeDate(end, valueEnd) ? end : valueEnd\n        ];\n\n        return value;\n\n    }\n\n    /**\n     * 格式化日期区间\n     *\n     * @param {Array<Date>} date 源日期对象\n     * @return {Array<string>} 格式化后的日期字符串\n     * @private\n     */\n    stringifyValue(date) {\n        return date.map(date => this.formatDate(date));\n    }\n\n    /**\n     * 点击 Label 时触发，打开浮层\n     *\n     * @private\n     */\n    onLabelClick() {\n\n        const {\n            disabled,\n            readOnly\n        } = this.props;\n\n        if (disabled || readOnly) {\n            return;\n        }\n\n        this.setState({open: true});\n    }\n\n    /**\n     * 点击取消时触发\n     *\n     * @private\n     */\n    onCancel() {\n        this.setState({\n            open: false\n        });\n    }\n\n    /**\n     * CalendarPanel 日期变更时触发\n     * 当属性 autoConfirm 为 true 时，自动执行 onConfirm\n     *\n     * @param {number} index   0 - 开始时间改变， 1 - 结束时间改变\n     * @param {Object} e       事件对象\n     * @param {Date}   e.value 改变后的日期值\n     * @private\n     */\n    onDateChange(index, e) {\n\n        const value = e.value;\n\n        let date = [].concat(this.state.date);\n\n        date[index] = value;\n\n        this.setState({\n            date\n        });\n    }\n\n    /**\n     * 在浮层上点击确定按钮时触发\n     *\n     * @private\n     */\n    onConfirm() {\n\n        const {date, value} = this.state;\n\n        // 不管怎么样，先把窗口关了\n        this.setState({\n            open: false\n        }, () => {\n\n            // 如果值发生了变化，那么释放一个 change 事件\n            if (\n                !DateTime.isEqualDate(date[0], this.parseDate(value[0]))\n                || !DateTime.isEqualDate(date[1], this.parseDate(value[1]))\n            ) {\n                super.onChange({\n                    type: 'change',\n                    target: this,\n                    value: date.map(this.formatDate, this)\n                });\n            }\n\n        });\n\n    }\n\n    /**\n     * 按设置格式化日期\n     *\n     * @param {Date} date 日期\n     * @return {string}\n     * @private\n     */\n    formatDate(date) {\n\n        return DateTime.format(\n            date,\n            this.props.dateFormat\n        );\n    }\n\n    /**\n     * 格式化日期对象\n     *\n     * @param  {string} date  日期字符串\n     * @return {Date}         转化后的日期对象\n     * @private\n     */\n    parseDate(date) {\n\n        if (typeof date !== 'string') {\n            return date;\n        }\n\n        let format = this.props.dateFormat;\n\n        return DateTime.parse(date, format);\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {React.Element}\n     */\n    render() {\n\n        const props = this.props;\n\n        let {\n            lang,\n            disabled,\n            size,\n            name,\n            begin,\n            end,\n            placeholder,\n            ...others\n        } = props;\n\n        const {open, date, value, validity} = this.state;\n\n        begin = begin ? this.parseDate(begin) : null;\n        end = end ? this.parseDate(end) : null;\n\n        return (\n            <div\n                {...others}\n                className={cx(props).addStates({focus: open}).build()}>\n                <input\n                    name={name}\n                    ref=\"input\"\n                    type=\"hidden\"\n                    value={value.join(',')}\n                    disabled={disabled} />\n                <label onClick={this.onLabelClick}>\n                    {value.length === 0\n                        ? (\n                            <span className={cx().part('label-placeholder').build()}>\n                                {placeholder}\n                            </span>\n                        ) : `${value[0]} 至 ${value[1]}`\n                    }\n                    <Icon icon='expand-more' />\n                </label>\n                <Validity validity={validity} />\n                <Confirm\n                    open={open}\n                    variants={['calendar']}\n                    onConfirm={this.onConfirm}\n                    onCancel={this.onCancel}\n                    size={size}\n                    buttonVariants={['secondery', 'calendar']} >\n                    <div className={cx().part('row').build()}>\n                        <Panel\n                            lang={lang}\n                            date={date[0]}\n                            begin={begin}\n                            end={date[1] || new Date()}\n                            onChange={this.onDateChange.bind(this, 0)} />\n                        <Panel\n                            lang={lang}\n                            date={date[1]}\n                            begin={date[0] || new Date()}\n                            end={end}\n                            onChange={this.onDateChange.bind(this, 1)} />\n                    </div>\n                </Confirm>\n            </div>\n        );\n\n    }\n\n}\n\nRangeCalendar.displayName = 'RangeCalendar';\n\nRangeCalendar.defaultProps = {\n    ...Calendar.defaultProps,\n    defaultValue: [],\n    placeholder: '请选择'\n};\n\nRangeCalendar.propTypes = {\n    ...Calendar.propTypes,\n    defaultValue: PropTypes.arrayOf(PropTypes.string),\n    autoOk: PropTypes.bool,\n    dateFormat: PropTypes.string,\n    begin: PropTypes.oneOfType([\n        PropTypes.object,\n        PropTypes.string\n    ]),\n    end: PropTypes.oneOfType([\n        PropTypes.object,\n        PropTypes.string\n    ])\n};\n\nRangeCalendar.childContextTypes = InputComponent.childContextTypes;\n\nRangeCalendar.contextTypes = InputComponent.contextTypes;\n"]}