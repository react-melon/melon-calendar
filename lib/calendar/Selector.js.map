{"version":3,"sources":["calendar/Selector.js"],"names":["DateTime","cx","CalendarSelector","props","componentDidMount","autoScroll","componentDidUpdate","onClick","bind","item","refs","findDOMNode","scrollIntoView","e","onChange","target","mode","date","isMonthView","minDate","maxDate","onlyOneYear","isDate","yearDiff","render","rest","children","y","getFullYear","m","getMonth","d","getDate","map","month","index","newDate","Date","disabled","isBeforeMonth","isAfterMonth","selected","maxRange","MAX_RANGE","forEach","year","push","build","displayName","propTypes","object","isRequired","func","oneOf"],"mappings":"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","file":"Selector.js","sourcesContent":["/**\n * @file Calendar/CalendarSelector\n * @author cxtom(cxtom2008@gmail.com)\n */\n\nimport React, {PropTypes, Component} from 'react';\nimport ReactDOM from 'react-dom';\nimport {create} from 'melon-core/classname/cxBuilder';\nimport Item from './SelectorItem';\nimport * as DateTime from '../util';\nimport {range} from 'melon-core/util/array';\n\nconst cx = create('CalendarSelector');\n\n/**\n * melon-calendar 年/月选择面板\n *\n * @class\n * @extends {React.Component}\n */\nexport default class CalendarSelector extends Component {\n\n    /**\n     * 构造函数\n     *\n     * @param  {Object} props   组件属性\n     * @public\n     */\n    constructor(props) {\n        super(props);\n        this.onClick = this.onClick.bind(this);\n    }\n\n    /**\n     * 组件mount时触发，当前选择的年/月需要在可见范围\n     *\n     * @public\n     */\n    componentDidMount = this.autoScroll\n\n    /**\n     * 组件更新时触发，当前选择的年/月需要在可见范围\n     *\n     * @public\n     */\n    componentDidUpdate = this.autoScroll\n\n    /**\n     * 使选择的年/月在可见范围\n     *\n     * @public\n     */\n    autoScroll() {\n        const item = this.refs.item ? ReactDOM.findDOMNode(this.refs.item) : null;\n        item && item.scrollIntoView && item.scrollIntoView();\n    }\n\n    /**\n     * 点击某月/年时触发\n     *\n     * @param  {Object} e      事件对象\n     * @param  {string} e.mode 年/月\n     * @param  {Date}   e.date 日期\n     */\n    onClick(e) {\n\n        const onChange = this.props.onChange;\n\n        if (onChange) {\n            onChange({\n                target: this,\n                mode: e.mode,\n                date: e.date\n            });\n        }\n    }\n\n    /**\n     * 是否显示月份\n     *\n     * @return {boolean}\n     * @private\n     */\n    isMonthView() {\n\n        const {\n            minDate,\n            maxDate,\n            mode\n        } = this.props;\n\n        let onlyOneYear = false;\n\n        // 如果范围中只有一年，则跳过yearview，直接显示month view\n        if (mode === 'year' && DateTime.isDate(minDate) && DateTime.isDate(maxDate)) {\n            onlyOneYear = (DateTime.yearDiff(minDate, maxDate) === 0);\n        }\n\n        return mode === 'month' || onlyOneYear;\n    }\n\n    /**\n     * 渲染\n     *\n     * @public\n     * @return {React.Element}\n     */\n    render() {\n\n        const {\n            minDate,\n            maxDate,\n            date,\n            ...rest\n        } = this.props;\n\n        let children = [];\n\n        const y = date.getFullYear();\n        const m = date.getMonth();\n        const d = date.getDate();\n\n        if (this.isMonthView()) {\n            children = range(12).map((month, index) => {\n\n                const newDate = new Date(y, month, d);\n                const disabled = (DateTime.isDate(minDate) && DateTime.isBeforeMonth(newDate, minDate))\n                                || (DateTime.isDate(maxDate) && DateTime.isAfterMonth(newDate, maxDate));\n                const selected = month === m;\n\n                return (\n                    <Item\n                        key={index}\n                        mode=\"month\"\n                        ref={selected ? 'item' : null}\n                        date={newDate}\n                        onClick={this.onClick}\n                        disabled={disabled}\n                        selected={selected} />\n                );\n\n            });\n        }\n        else {\n\n            const maxRange = CalendarSelector.MAX_RANGE;\n\n            range(y - maxRange, y + maxRange).forEach((year, index) => {\n\n                if ((DateTime.isDate(minDate) && year < minDate.getFullYear())\n                    || (DateTime.isDate(maxDate) && year > maxDate.getFullYear())) {\n\n                    return;\n                }\n\n                const newDate = new Date(year, m, d);\n                const selected = year === y;\n\n                children.push(\n                    <Item\n                        key={index}\n                        mode=\"year\"\n                        ref={selected ? 'item' : null}\n                        date={newDate}\n                        onClick={this.onClick}\n                        selected={selected} />\n                );\n\n            });\n\n        }\n\n        return (\n            <ul {...rest} className={cx(this.props).build()}>\n                {children}\n            </ul>\n        );\n\n    }\n\n}\n\nCalendarSelector.displayName = 'CalendarSelector';\n\nCalendarSelector.MAX_RANGE = 10;\n\nCalendarSelector.propTypes = {\n    date: PropTypes.object.isRequired,\n    maxDate: PropTypes.object,\n    minDate: PropTypes.object,\n    onChange: PropTypes.func,\n    mode: PropTypes.oneOf(['month', 'year'])\n};\n"]}